<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Facebook Photo Storage | myBlog</title><meta name="keywords" content="cloud computing"><meta name="author" content="Donald Lam,manholam8@gmail.com"><meta name="copyright" content="Donald Lam"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Photo SearchFor each photo, four versions (called images) are stored and they are: large, medium, small, and thumbnail  Challenges: Looking up a single file from a huge set of files  Design Goals  Hig">
<meta property="og:type" content="article">
<meta property="og:title" content="Facebook Photo Storage">
<meta property="og:url" content="https://github.com/DonaldLamNL/myBlog/2023/11/30/2023/CSCI4180/2023-11-30-CSCI4180-Facebook-Photo-Storage/index.html">
<meta property="og:site_name" content="myBlog">
<meta property="og:description" content="Photo SearchFor each photo, four versions (called images) are stored and they are: large, medium, small, and thumbnail  Challenges: Looking up a single file from a huge set of files  Design Goals  Hig">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://p.ipic.vip/ppekay.jpg">
<meta property="article:published_time" content="2023-11-29T16:00:00.000Z">
<meta property="article:modified_time" content="2023-11-29T16:00:00.000Z">
<meta property="article:author" content="Donald Lam">
<meta property="article:tag" content="cloud computing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.ipic.vip/ppekay.jpg"><link rel="shortcut icon" href="/myBlog/img/favicon.png"><link rel="canonical" href="https://github.com/DonaldLamNL/myBlog/2023/11/30/2023/CSCI4180/2023-11-30-CSCI4180-Facebook-Photo-Storage/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/myBlog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/myBlog/',
  algolia: undefined,
  localSearch: {"path":"/myBlog/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Facebook Photo Storage',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-30 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://p.ipic.vip/5dc8z2.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/myBlog/archives/"><div class="headline">Articles</div><div class="length-num">57</div></a><a href="/myBlog/tags/"><div class="headline">Tags</div><div class="length-num">13</div></a><a href="/myBlog/categories/"><div class="headline">Categories</div><div class="length-num">11</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/myBlog/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://p.ipic.vip/ppekay.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/myBlog/">myBlog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/myBlog/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Facebook Photo Storage</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-11-29T16:00:00.000Z" title="Created 2023-11-30 00:00:00">2023-11-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-11-29T16:00:00.000Z" title="Updated 2023-11-30 00:00:00">2023-11-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/myBlog/categories/CSCI4180/">CSCI4180</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Facebook Photo Storage"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Photo-Search"><a href="#Photo-Search" class="headerlink" title="Photo Search"></a>Photo Search</h2><p>For each photo, four versions (called images) are stored and they are: <font color="3A75EA">large</font>, <font color="3A75EA">medium</font>, <font color="3A75EA">small</font>, and <font color="3A75EA">thumbnail</font></p>
<ul>
<li><p><strong>Challenges:</strong> Looking up a single file from a huge set of files</p>
</li>
<li><p><strong>Design Goals</strong></p>
<ol>
<li>High throughput and latency: Minimize disk I/Os</li>
<li>Fault tolerant: Replicate photos in geographically distinct locations</li>
<li>Cost effective: Cost per terabyte of usage must be kept low</li>
<li>Simple: Straightforward to implement and maintain</li>
</ol>
</li>
</ul>
<h3 id="Typical-Design"><a href="#Typical-Design" class="headerlink" title="Typical Design"></a>Typical Design</h3><p><img src="https://p.ipic.vip/hibqyg.png" width="500px" /></p>
<ul>
<li><p><strong>CDN (content delivery network):</strong> is a network of nodes that cache contents.</p>
<p>  For example, clients want to retrieve some photos on a website. First, it would provide a query to local DNS, if local DNS does not know the mapping, it would forward the query to higher-level DNS servers with more mapping. But “todaynic.com” DNS does not directly return the IP address for “hksimg.com”, it returns the host name for the CDN server. Then, the local DNS server would try to use the hostname to resolve the IP address and contact the AWS DNS to get the IP address.</p>
<p>  <img src="https://p.ipic.vip/5noti4.png" width="500px" /></p>
</li>
<li><p>CDN serves a large-scale cache</p>
<ul>
<li><font color="880ED4">Pros</font>: world-wide scale deployment, fast response time</li>
<li><font color="880ED4">Cons</font>: cannot control the content (DNS is also size limited, it would remove the old content if space insufficient)</li>
</ul>
</li>
<li><p><strong><font color="880ED4">Limitations</font></strong><br>  Facebook (or social networking sites in general) has a very different access pattern from web sites that <font color="3A75EA">old contents are frequently visited</font> (<font color="00A300">e.g, friend’s album</font>)</p>
</li>
</ul>
<!-- ### NFS-based Design
The old photo infrastructure had several tiers:
    - Upload tier receives users’ photo uploads, scales the original images and saves them on the NFS storage tier.
    - Photo serving tier processes HTTP requests for images
    - NFS storage tier built on top of commercial storage appliances.

- An enormous amount of metadata is generated on the storage tier due to the namespace directories and file inodes.
- The amount of metadata far exceeds the caching abilities of the NFS storage tier
    - multiple disk I/Os per photo per upload/read request
- High degree of reliance on CDNs = expensive -->
<h2 id="Haystack"><a href="#Haystack" class="headerlink" title="Haystack"></a>Haystack</h2><p><img src="https://p.ipic.vip/9q6m5l.png" width="500px" /></p>
<ul>
<li><p><strong>User Operations</strong></p>
<ol>
<li><p>Web server forwards the request to the Haystack Directory</p>
</li>
<li><p>The Haystack Directory constructs URL for each photo</p>
<ul>
<li>http://<font color="F54747">&lt;CDN&gt;</font>/<font color="3A75EA">&lt;Cache&gt;</font>/<font color="00A300">&lt;Machine id&gt;</font>/<font color="880ED4">&lt;Logical volume,Photo&gt;</font></li>
</ul>
</li>
<li><p>CDN looks up the photo internally</p>
<ul>
<li>If CDN lookup fails, the CDN strips the &lt;CDN&gt; part from the URL and contacts the Haystack Cache</li>
<li>If Cache lookup fails, the Haystack Cache strips the &lt;Cache&gt; part from the URL and contacts the Haystack Store</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="Haystack-Directory"><a href="#Haystack-Directory" class="headerlink" title="Haystack Directory"></a>Haystack Directory</h3><ul>
<li>Directory have a global view of the storage, similar to the namenode in HDFS</li>
<li>Four main functions:<ol>
<li>Provides a mapping from logical volumes to physical volumes</li>
<li>Load balances writes across logical volumes</li>
<li>Determines whether a photo request should be handled by the CDN or by the Haystack Cache</li>
<li>Identifies logical volumes that are read-only</li>
</ol>
</li>
</ul>
<h3 id="Haystack-Cache"><a href="#Haystack-Cache" class="headerlink" title="Haystack Cache"></a>Haystack Cache</h3><ul>
<li><p>Distributed hash table, uses photo’s id to locate cached data</p>
</li>
<li><p>Receives HTTP requests from CDNs and browsers</p>
<ul>
<li>If photo is in Cache, return the photo</li>
<li>If photo is not in Cache, fetches photo from the Store and returns the photo</li>
</ul>
</li>
<li><p>Add a photo to Cache if any one of two conditions are met:</p>
<ol>
<li><p>The request comes directly from a browser, not the CDN</p>
<font color="F54747">Because if the photo is not in the Cache, the Cache will return the photo to the CDN, and CDN itself is also a Cache, so CDN supposely would cache the photo. It is needless to cache two copies of photo in different part of Caches.</font>
</li>
<li><p>The photo is fetched from a write-enabled Store machine</p>
<font color="F54747">Because the photo fetched by a write-enabled Store machine is likely to be accessed very soon</font>



</li>
</ol>
</li>
</ul>
<h3 id="Haystack-Store"><a href="#Haystack-Store" class="headerlink" title="Haystack Store"></a>Haystack Store</h3><p>Haystack Store would pack the images together, each image is called needle, each needle consists of multiple fields<br><img src="https://p.ipic.vip/8bxm0h.png" width="500px" /></p>
<ul>
<li><p><strong>Haystack store file</strong></p>
<ul>
<li>A superblock file accompanied by many needles</li>
<li>Log-structured format: <font color="3A75EA">append-only</font></li>
</ul>
</li>
<li><p><strong>Haystack index file</strong></p>
<ul>
<li>provides minimal metadata required to locate a particular needle in the store</li>
<li>Same order as store file</li>
<li>A subset of store file, butwithout photo data</li>
<li>For disaster recovery</li>
<li>Less than 1% of store file</li>
</ul>
</li>
<li><p><strong>Read</strong></p>
<ul>
<li>Each store machine maintains an in-memory index, which accessing in-memory does not count I/O</li>
</ul>
<ol>
<li>Look up the in-memory index (0 I/O)<ul>
<li>The offset in the Haystack store file is found (Assume store file is always opened)</li>
</ul>
</li>
<li>Seek and read by moving the disk arm to the beginning of the needle (1 I/O)<ul>
<li>Seek takes (1 I/O)</li>
<li>Since the photo is sequentially written, no further I/O ops incurred</li>
</ul>
</li>
</ol>
<ul>
<li><font color="F54747">In total, 1 I/O</font>


</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>Write</strong></p>
<ul>
<li>Fault Tolerance: three replicas</li>
</ul>
<ol>
<li>Append 4 images to the haystack store file<ul>
<li>Seek to the end of file and sequentially write (1 I/O) [3 replicas, 3 I/Os]</li>
</ul>
</li>
<li>Append 4 images to the haystack index file<br> Seek and then sequentially write (1 I/O)</li>
<li>Update the in-memory index (0 I/O)</li>
</ol>
<ul>
<li><font color="F54747">In total, 6 I/Os (2 I/Os * 3 replicas)</font>


</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>Delete</strong></p>
<ul>
<li>Need to delete 3 replicas</li>
</ul>
<ol>
<li>Remove the files in the in-memory index</li>
<li>Mark the 4 images of file deleted (modify the flag of the needles)<ul>
<li>Noice: these flags are located in different position, which cannot modify it by 1 I/O to update the flags in all 4 different places, and need to issue 4 non-sequential I/Os to update the files individually.</li>
<li>4 seek-and-write for images</li>
<li>another 4 for indexes</li>
</ul>
</li>
</ol>
<ul>
<li><font color="F54747">In total, 24 I/Os (8 I/Os * 3 replicas)</font>



</li>
</ul>
</li>
</ul>
<h3 id="Contributions"><a href="#Contributions" class="headerlink" title="Contributions"></a>Contributions</h3><ul>
<li>Reduced disk I/O<ul>
<li>10 TB/node -&gt; 10 GB of metadata<ul>
<li>~10 bytes per image, ~40 bytes per photo</li>
<li>This amount is easily cacheable!</li>
</ul>
</li>
</ul>
</li>
<li>Simplified metadata<ul>
<li>No directory structures/file names<ul>
<li>64-bit ID</li>
</ul>
</li>
<li>Results in easier lookups</li>
</ul>
</li>
<li>Single photo serving and storage layer<ul>
<li>Direct I/O path between client and storage</li>
<li>Results in higher bandwidth</li>
</ul>
</li>
</ul>
<h2 id="BLOB-Storage"><a href="#BLOB-Storage" class="headerlink" title="BLOB Storage"></a>BLOB Storage</h2><ul>
<li>An important class of data that Facebook stores is <strong><font color="F54747">Binary Large OBjects (BLOBs)</font></strong></li>
<li>BLOBs are <font color="F54747">immutable binary data</font> (Created once, read many times, never modified, may be deleted)</li>
<li><font color="00A300">Examples of BLOBs: Photos, videos, documents, traces, heap dumps, and source code</font>

<p>  <img src="https://p.ipic.vip/s2uerp.png" width="400px" /></p>
<ul>
<li><font color="3A75EA">There exist significant diversities in BLOB sizes for different types</font>


</li>
</ul>
</li>
</ul>
<h3 id="Temperature-Zones-Exist"><a href="#Temperature-Zones-Exist" class="headerlink" title="Temperature Zones Exist"></a>Temperature Zones Exist</h3><ul>
<li><strong>Temperatures (access frequency)</strong><ul>
<li>Hot: BLOBs receive many requests</li>
<li>Warm: BLOBs receive few requests</li>
<li>Cold: BLOBs almost receive no requests<ul>
<li>Need to be stored persistently</li>
<li>Take days or hours to retrieve</li>
</ul>
</li>
</ul>
</li>
<li><p>Strong correlation between age and temperature of a BLOB</p>
<p>  <img src="https://p.ipic.vip/ojqtfa.png" width="600px" /></p>
<ul>
<li><font color="3A75EA">Request rates drop over time (temperature drop over time)</font></li>
<li>But please notice that even the data is old, they may still regularly be accessed</li>
</ul>
</li>
<li><p><strong>Warm Content is a Lot!</strong></p>
<ul>
<li>Warm cutoff: 1 month</li>
<li><p>More than 80% of objects are warm of all types (Remaining 20% of objects are hot)</p>
</li>
<li><p>Applying <font color="3A75EA">replication</font> to warm content provides <font color="3A75EA">fault tolerance</font>, but introduces very <font color="F54747">high storage overhead</font></p>
<ul>
<li><strong>Haystack uses replication for fault tolerance, BUT it is not suitable for using Haystack for warm storage</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Facebook’s-BLOB-Storage"><a href="#Facebook’s-BLOB-Storage" class="headerlink" title="Facebook’s BLOB Storage"></a>Facebook’s BLOB Storage</h3><p><img src="https://p.ipic.vip/xqkjag.png" width="500px" /><br>Haystack and f4 are at the same layer, if the data is hot, they will be stored in Haystack, if they become warm, they will be moved and stored in f4</p>
<h3 id="Haystack-Fault-Tolerance"><a href="#Haystack-Fault-Tolerance" class="headerlink" title="Haystack Fault Tolerance"></a>Haystack Fault Tolerance</h3><p>Replication Factor: to quantify the storage overhead.<br>Store x amount of data, in fact it is required to introduce some redundancy for fault torlarence, so the actual amount of data is y (&gt; 0). Replication Factor = y/x (min. = 1).</p>
<ul>
<li><p><font color="3A75EA">Triple replication</font> of data files + (10+2)-RAID-6 (those data would be stored in different racks or servers)</p>
<ul>
<li>In each host, the raid is attached which is a redundancy scheme that provides fault tolerance against failures (RAID-5: one disk failure, RAID-6: two disk failures)</li>
<li><font color="3A75EA">(10+2)-RAID-6</font>: 10 disks are storing data, and two additional disks are storing the redundant data (parity)</li>
</ul>
</li>
<li><p>Replication factor = 1.2 x 3 = 3.6x (minimum number of disk failures that cause data loss: 9)</p>
</li>
</ul>
<h3 id="f4-Fault-Tolerance"><a href="#f4-Fault-Tolerance" class="headerlink" title="f4 Fault Tolerance"></a>f4 Fault Tolerance</h3><ul>
<li>Goal: achieve storage-efficient fault tolerance</li>
<li><p>Four types of failures:</p>
<ol>
<li>Drive failures, at a low single digit annual rate</li>
<li>Host failures, periodically</li>
<li>Rack failures, multiple time per year</li>
<li>Datacenter failures, extremely rare and usually transient but potentially more disastrous</li>
</ol>
</li>
<li><p>A datacenter is partitioned in cells, each using 14 racks of 15 hosts with 30 4TB drives per host</p>
<ul>
<li><font color="3A75EA">Each cell has 25PB raw storage</font>



</li>
</ul>
</li>
</ul>
<h2 id="Erasure-Coding"><a href="#Erasure-Coding" class="headerlink" title="Erasure Coding"></a>Erasure Coding</h2><ul>
<li>Divide file to <strong>k</strong> <font color="F54747">data blocks</font></li>
<li>Encode data blocks to additional <strong>n-k</strong> parity blocks (<font color="00A300">e.g., linear multiplication</font>)</li>
<li>Distribute n data/parity blocks (a stripe) to n nodes</li>
<li><p><font color="F54747">Fault tolerance</font>: <strong><font color="F54747">any k out of n blocks can recover file data</font></strong><br>  <img src="https://p.ipic.vip/jzylia.png" width="500px" /></p>
<ul>
<li>Redundancy Factor: $4/2 = 2\times$ (i.e., $n/k$)</li>
</ul>
</li>
<li><p>Bitwise XOR:<br>  <img src="https://p.ipic.vip/cxudma.png" width="500px" /></p>
</li>
</ul>
<h3 id="Reed-Solomon-codes"><a href="#Reed-Solomon-codes" class="headerlink" title="Reed-Solomon codes"></a>Reed-Solomon codes</h3><ul>
<li>Support any n and k (provided that n &gt; k)</li>
<li>Minimum storage redundancy to provide the fault tolerance against any n-k failures</li>
<li><p>f4: (n, k) = (14, 10)</p>
<ul>
<li>any 10 of this 14 blocks can recover the original data</li>
<li>Redundancy Factor: $14/10 = 1.4\times$ (i.e., $n/k$)</li>
</ul>
</li>
<li><p><strong><font color="880ED4">Advantages:</font></strong></p>
<ul>
<li>Reduce storage space</li>
<li>High fault tolerance</li>
</ul>
</li>
<li><strong><font color="880ED4">Disadvantages:</font></strong><ul>
<li>In general, k blocks needed to recover a lost block<br><font color="F54747">Expensive Repair Operarion (read amplification)</font>: It needs to read more data in order to recover some lost data. Any k out of n blocks can recover the data, so even if one block lost, still need to first read k blocks to recover the original data, in order to recover a particular block.</li>
</ul>
</li>
</ul>
<h3 id="Erasure-Coding-in-f4"><a href="#Erasure-Coding-in-f4" class="headerlink" title="Erasure Coding in f4"></a>Erasure Coding in f4</h3><ul>
<li>Consider a big Block size = 1GB<ul>
<li>Each block contains multiple BLOBs</li>
<li>Large block size reduces metadata management</li>
</ul>
</li>
<li><p>Block layout in an f4 cell</p>
<ul>
<li>Distribute each <font color="3A75EA">RS(14,10)</font> stripe across 14 racks (10 blocks, generate 4 additional parity blocks, and distribute them into 14 nodes, each node is located in a distinct rack)</li>
<li>Tolerate rack, host, and disk failures of an f4 cell (<font color="F54747">Up to 4 racks, up to 4 hosts and up to 4 disks</font> failures can be tolerate)<br><img src="https://p.ipic.vip/lpyz3a.png" width="500px" /></li>
</ul>
</li>
<li><p>How to tolerate data <strong>center failures</strong>?</p>
<ul>
<li><strong><font color="F54747">Double replication</font></strong>: Replicating a stripe in two cells at two different data centers<ul>
<li>Redundancy factor = 1.4 * 2 = 2.8x</li>
</ul>
</li>
<li><strong><font color="F54747">Geo-distributed XOR coding</font></strong>: Add an XOR parity to two stripes<ul>
<li>Redundancy factor = 1.4 * 1.5 = 2.1x<br><img src="https://p.ipic.vip/9wf1te.png" width="500px" /></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- 
<img src="" width="500px" />
<font color="3A75EA">Blue</font>
<font color="F54747">Red</font>
<font color="880ED4">Purple</font>
<font color="00A300">Green</font>
--></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://github.com/DonaldLamNL/myBlog">Donald Lam</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://github.com/DonaldLamNL/myBlog/2023/11/30/2023/CSCI4180/2023-11-30-CSCI4180-Facebook-Photo-Storage/">https://github.com/DonaldLamNL/myBlog/2023/11/30/2023/CSCI4180/2023-11-30-CSCI4180-Facebook-Photo-Storage/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/myBlog/tags/cloud-computing/">cloud computing</a></div><div class="post_share"><div class="social-share" data-image="https://p.ipic.vip/ppekay.jpg" data-sites="facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/myBlog/2023/12/15/2023/CSCI4180/2023-12-15-CSCI4180-Zookeeper/"><img class="prev-cover" src="https://p.ipic.vip/ppekay.jpg" onerror="onerror=null;src='/myBlog/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Zookeeper</div></div></a></div><div class="next-post pull-right"><a href="/myBlog/2023/11/25/2023/CSCI4180/2023-11-25-CSCI4180-Duplication/"><img class="next-cover" src="https://p.ipic.vip/ppekay.jpg" onerror="onerror=null;src='/myBlog/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Duplication</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/myBlog/2023/09/18/2023/ESTR4300/2023-9-18-ESTR4300-hadoop-clusters-setup/" title="Hadoop Cluster Setup"><img class="cover" src="https://p.ipic.vip/ppekay.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-18</div><div class="title">Hadoop Cluster Setup</div></div></a></div><div><a href="/myBlog/2023/10/15/2023/CSCI4180/2023-10-15-CSCI4180-MapReduce/" title="MapReduce Programming"><img class="cover" src="https://p.ipic.vip/ppekay.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">MapReduce Programming</div></div></a></div><div><a href="/myBlog/2023/10/30/2023/CSCI4180/2023-10-30-CSCI4180-MapReduce-Applications/" title="MapReduce Applications"><img class="cover" src="https://p.ipic.vip/ppekay.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-30</div><div class="title">MapReduce Applications</div></div></a></div><div><a href="/myBlog/2023/11/13/2023/CSCI4180/2023-11-13-CSCI4180-Key-Value-Stores/" title="Key-Value Stores"><img class="cover" src="https://p.ipic.vip/ppekay.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-13</div><div class="title">Key-Value Stores</div></div></a></div><div><a href="/myBlog/2023/09/15/2023/CSCI4180/2023-9-15-CSCI4180-Hadoop/" title="Hadoop Overview"><img class="cover" src="https://p.ipic.vip/ppekay.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-15</div><div class="title">Hadoop Overview</div></div></a></div><div><a href="/myBlog/2023/12/15/2023/CSCI4180/2023-12-15-CSCI4180-Zookeeper/" title="Zookeeper"><img class="cover" src="https://p.ipic.vip/ppekay.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-15</div><div class="title">Zookeeper</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://p.ipic.vip/5dc8z2.jpeg" onerror="this.onerror=null;this.src='/myBlog/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Donald Lam</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/myBlog/archives/"><div class="headline">Articles</div><div class="length-num">57</div></a><a href="/myBlog/tags/"><div class="headline">Tags</div><div class="length-num">13</div></a><a href="/myBlog/categories/"><div class="headline">Categories</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://donaldlamnl.github.io/myWeb/#/home"><i></i><span>My Personal Website</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/DonaldLamNL" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:manholam8@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Photo-Search"><span class="toc-number">1.</span> <span class="toc-text">Photo Search</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Typical-Design"><span class="toc-number">1.1.</span> <span class="toc-text">Typical Design</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Haystack"><span class="toc-number">2.</span> <span class="toc-text">Haystack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Haystack-Directory"><span class="toc-number">2.1.</span> <span class="toc-text">Haystack Directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Haystack-Cache"><span class="toc-number">2.2.</span> <span class="toc-text">Haystack Cache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Haystack-Store"><span class="toc-number">2.3.</span> <span class="toc-text">Haystack Store</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Contributions"><span class="toc-number">2.4.</span> <span class="toc-text">Contributions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BLOB-Storage"><span class="toc-number">3.</span> <span class="toc-text">BLOB Storage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Temperature-Zones-Exist"><span class="toc-number">3.1.</span> <span class="toc-text">Temperature Zones Exist</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Facebook%E2%80%99s-BLOB-Storage"><span class="toc-number">3.2.</span> <span class="toc-text">Facebook’s BLOB Storage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Haystack-Fault-Tolerance"><span class="toc-number">3.3.</span> <span class="toc-text">Haystack Fault Tolerance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#f4-Fault-Tolerance"><span class="toc-number">3.4.</span> <span class="toc-text">f4 Fault Tolerance</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Erasure-Coding"><span class="toc-number">4.</span> <span class="toc-text">Erasure Coding</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Reed-Solomon-codes"><span class="toc-number">4.1.</span> <span class="toc-text">Reed-Solomon codes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Erasure-Coding-in-f4"><span class="toc-number">4.2.</span> <span class="toc-text">Erasure Coding in f4</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2023/12/15/2023/CSCI4180/2023-12-15-CSCI4180-Zookeeper/" title="Zookeeper"><img src="https://p.ipic.vip/ppekay.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.jpg'" alt="Zookeeper"/></a><div class="content"><a class="title" href="/myBlog/2023/12/15/2023/CSCI4180/2023-12-15-CSCI4180-Zookeeper/" title="Zookeeper">Zookeeper</a><time datetime="2023-12-14T16:00:00.000Z" title="Created 2023-12-15 00:00:00">2023-12-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2023/11/30/2023/CSCI4180/2023-11-30-CSCI4180-Facebook-Photo-Storage/" title="Facebook Photo Storage"><img src="https://p.ipic.vip/ppekay.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.jpg'" alt="Facebook Photo Storage"/></a><div class="content"><a class="title" href="/myBlog/2023/11/30/2023/CSCI4180/2023-11-30-CSCI4180-Facebook-Photo-Storage/" title="Facebook Photo Storage">Facebook Photo Storage</a><time datetime="2023-11-29T16:00:00.000Z" title="Created 2023-11-30 00:00:00">2023-11-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2023/11/25/2023/CSCI4180/2023-11-25-CSCI4180-Duplication/" title="Duplication"><img src="https://p.ipic.vip/ppekay.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.jpg'" alt="Duplication"/></a><div class="content"><a class="title" href="/myBlog/2023/11/25/2023/CSCI4180/2023-11-25-CSCI4180-Duplication/" title="Duplication">Duplication</a><time datetime="2023-11-24T16:00:00.000Z" title="Created 2023-11-25 00:00:00">2023-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2023/11/13/2023/CSCI4180/2023-11-13-CSCI4180-Key-Value-Stores/" title="Key-Value Stores"><img src="https://p.ipic.vip/ppekay.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.jpg'" alt="Key-Value Stores"/></a><div class="content"><a class="title" href="/myBlog/2023/11/13/2023/CSCI4180/2023-11-13-CSCI4180-Key-Value-Stores/" title="Key-Value Stores">Key-Value Stores</a><time datetime="2023-11-12T16:00:00.000Z" title="Created 2023-11-13 00:00:00">2023-11-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2023/10/30/2023/CSCI4180/2023-10-30-CSCI4180-MapReduce-Applications/" title="MapReduce Applications"><img src="https://p.ipic.vip/ppekay.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.jpg'" alt="MapReduce Applications"/></a><div class="content"><a class="title" href="/myBlog/2023/10/30/2023/CSCI4180/2023-10-30-CSCI4180-MapReduce-Applications/" title="MapReduce Applications">MapReduce Applications</a><time datetime="2023-10-29T16:00:00.000Z" title="Created 2023-10-30 00:00:00">2023-10-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Donald Lam</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/myBlog/js/utils.js"></script><script src="/myBlog/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/myBlog/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>